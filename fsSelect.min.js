(function(a){var d={init:function(a){return this.each(function(){d.iniElements(this);d.addEvents(this)})},iniElements:function(b){this.$select=a(b);b=a("<div></div>").addClass("input-group fs-search");var g=a("<input>").attr("type","text").attr("placeholder",c.placeholder).addClass("form-control"),f=a("<li></li>").addClass("fs-selectAll").text("Select All"),h=a("<li></li>").addClass("fs-deSelectAll").text("DeSelect All"),e=a("<li></li>").addClass("fs-showSelected").text("Show Selected"),f=a("<ul></ul>").addClass("dropdown-menu dropdown-menu-right").attr("role",
"menu").append(f,h,e),h=a("<button></button>").attr("type","button").addClass("btn btn-default dropdown-toggle").attr("data-toggle","dropdown").append('<span class="glyphicon-plus"></span>'),f=a("<div></div>").addClass("input-group-btn").append(h,f);b=b.append(g,f);this.$select.wrap("<div class=fs-wrap/>");this.$select.addClass("hidden");this.$wrap=this.$select.parent(".fs-wrap");this.$wrap.prepend(b);this.$select.before('<div class="fs-dropdown hidden"></div>');d.buildOptions(a(".fs-dropdown"))},
buildOptions:function(b){for(var g=0;g<c.optionNum;g++){var f=c.optionValues[g],e=d.shortenOptionText(f),f=a("<div></div>").addClass("fs-option").attr("value",f).attr("data-index",g),e=a("<div></div>").addClass("fs-option-label").append("<input type=checkbox />").append("<span></span>").find("span").addClass("fs-url").text(e).end();f.append(e);b.append(f)}},addEvents:function(){a(".input-group.fs-search").on("click",d.clickOnSearch);a(".fs-option").on("click",d.clickOnOption);a(".fs-option-label input").on("click",
d.chosenOption);a(".fs-search input").on("keyup",d.optionSearch);a(document).on("click","*",d.checkCloseDropdown);a(".fs-resourceMenuButton").on("click",d.clickOnResourceMenuButton);a(".fs-selectAll").on("click",d.selectAllResource);a(".fs-deSelectAll").on("click",d.deSelectAllResource);a(".fs-showSelected").on("click",d.showSelectedResource)},clickOnOption:function(b){"checkbox"!=a(b.target).attr("type")&&(b=a(b.target).closest(".fs-option"),b.hasClass("clicked")?(b.removeClass("clicked"),c.selectedOptionIndex=
-1):(-1!=c.selectedOptionIndex&&a(a(".fs-option")[c.selectedOptionIndex]).removeClass("clicked"),b.addClass("clicked"),c.selectedOptionIndex=parseInt(b.attr("data-index"))),e.optionClicked(this))},clickOnSearch:function(b){a(b.target).hasClass("resourceMenuButton")||d.openDropdown()},clickOnResourceMenuButton:function(){a(".fs-dropdown").hasClass("hidden")?d.openDropdown():d.closeDropdown();this.blur()},chosenOption:function(b){b=a(b.target).closest(".fs-option");b.hasClass("selected")?b.removeClass("selected"):
b.addClass("selected");d.updateChosenOption()},optionSearch:function(){var b=a(".fs-wrap"),c=a(this).val().replace(/[|\\{}()[\]^$+*?.]/g,"\\$&");b.find(".fs-option").removeClass("hidden");""!=c&&b.find(".fs-option").each(function(){var b=new RegExp(c,"gi");null===a(this).attr("value").match(b)&&a(this).addClass("hidden")})},checkCloseDropdown:function(b){a(b.target).closest(".fs-wrap").hasClass("fs-wrap")||d.closeDropdown()},shortenOptionText:function(b){b=b.split("//")[1];var c=b.length,d=a(".fs-wrap").get(0).clientWidth/
7.4;return c>d?(d=2*d/5,b.slice(0,d)+"..."+b.slice(c-d,c)):b},openDropdown:function(b){a(".fs-dropdown").removeClass("hidden")},closeDropdown:function(b){a(".fs-dropdown").addClass("hidden")},selectAllResource:function(){a(".fs-option:not(.hidden)").addClass("selected");a(".fs-option:not(.hidden)").each(function(){a(this).find("input").get(0).checked=!0;c.chosenOptionIndexes.push(parseInt(a(this).closest(".fs-option").attr("data-index")))});d.updateChosenOption();e.optionClicked(this)},deSelectAllResource:function(){a(".fs-option.selected:not(.hidden)").each(function(){a(this).find("input").get(0).checked=
!1});a(".fs-option:not(.hidden)").removeClass("selected");d.updateChosenOption();e.optionClicked(this)},showSelectedResource:function(){a(this).hasClass("clicked")?(a(".fs-option").removeClass("hidden"),a(".fs-showSelected").removeClass("clicked")):(a(".fs-option:not(.selected)").addClass("hidden"),a(".fs-showSelected").addClass("clicked"));e.optionClicked(this)},updateChosenOption:function(){c.chosenOptionIndexes=[];a(".fs-option.selected").each(function(){c.chosenOptionIndexes.push(parseInt(a(this).attr("data-index")))})},
clickOnOptionBind:function(b){a(".fs-option").on("click",function(c){"checkbox"!=a(c.target).attr("type")&&b()});return this},chooseOptionBind:function(b){a(".fs-option-label input").on("click",b);return this},mouseOverOptionBind:function(b){a(".fs-option").on("mouseover",b);return this},mouseOutOptionBind:function(b){a(".fs-option").on("mouseout",b);return this},unbindOptions:function(b,g){switch(arguments.length){case 0:a(".fs-option").unbind();break;case 1:a(".fs-option").unbind(b);break;case 2:console.log("selectedOptionIndex",
c.selectedOptionIndex);a(".fs-option").unbind(b,g);break;default:throw"wrong number of arguments";}d.addEvents();return this},selectAllBind:function(b){a(".fs-selectAll").on("click",b);return this},deSelectAllBind:function(b){a(".fs-deSelectAll").on("click",b);return this},showSelectedBind:function(b){a(".fs-showSelected").on("click",b);return this},getOptionNum:function(){return c.optionNum},getSelectedOptionIndex:function(){return c.selectedOptionIndex},getChosenOptionIndexes:function(){return c.chosenOptionIndexes},
getMouseIndex:function(){a(document).mousemove(function(b){c.mouseoverIndex=a(b.target).closest(".fs-option").attr("data-index")});return c.mouseoverIndex||-1},setChosenOptionIndexes:function(b){c.chosenOptionIndexes=b;a(".fs-option").each(function(){var b=parseInt(a(this).attr("data-index"));-1!=c.chosenOptionIndexes.findIndex(function(a){return a===b})?(a(this).find("input").get(0).checked=!0,a(this).addClass("selected")):(a(this).find("input").get(0).checked=!1,a(this).removeClass("selected"))})},
setSelectedOptionIndex:function(b){a(a(".fs-option")[c.selectedOptionIndex]).removeClass("clicked");c.selectedOptionIndex=b;-1!=c.selectedOptionIndex&&a(".fs-option")[c.selectedOptionIndex].addClass("clicked");e.optionClicked(a(".fs-dropdown"));e.optionClicked(a(".dropdown-menu"));return c.selectedOptionIndex}},c={optionNum:0,optionValues:[],placeholder:"",mouseoverIndex:-1,selectedOptionIndex:-1,chosenOptionIndexes:[]},e={optionClicked:function(b){$element=a(b);b=$element.closest("*[class*='dropdown']");
b.children().css("background-color","#fff");b.children(".clicked").css("background-color","#e1e1ea")}};a.fn.fsSelect=function(b){var e=a.extend({},{placeholder:"Resource filter",data:[]},b);c.optionNum=e.data.length;c.optionValues=e.data;c.placeholder=e.placeholder;if(d[b])return d[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof b&&b)a.error("Method "+b+" does not exist on jQuery.fsSelect");else return d.init.apply(this,arguments)}})(jQuery);
